<!DOCTYPE html>
<html>
    <head>
        <title>DC Municipal Regulations</title>
        <link href='reset.css' type='text/css' rel='stylesheet' />
        <link href='style.css' type='text/css' rel='stylesheet' />
    </head>
    <body>
        <div class='left'>
        <div class='header'>
            <h1>DC Municipal Regulations</h1>
            <p>This is an <em>unofficial</em> of the Washington, DC
            municipal regulations.</p>
        </div>
        <form action='POST'>
            <input type='text' id='search' placeholder='search' />
        </form>
        </div>
        <div class='right'>
            <div id='output'></div>
        </div>
        <script src='jquery.js'></script>
        <script>
            var indexes = {}, titles;
            $.getJSON('titles.json', function(o) {
                titles = o;
            });
            var $output = $('#output');
            $('#search').keyup(function() {
                var v = this.value;
                var norm = v.replace(/[^A-Za-z]/g, '').toLowerCase();
                if (norm.length > 2) {
                    var a = norm[0];
                    if (!indexes[a]) {
                        indexes[a] = {};
                        $('#output').text('');
                        $.getJSON('indexes/' + a + '.json', function(o) {
                            indexes[a] = o;
                        });
                    } else {
                        $output.empty();
                        (indexes[a][norm] || []).map(function(i) {
                            var d = document.createElement('div');
                            d.className = 'result';
                            var link = document.createElement('a');
                            link.href = 'text/' + i + '.txt';
                            var h3 = document.createElement('h3');
                            h3.innerHTML = titles[i];
                            link.appendChild(h3);
                            d.appendChild(link);
                            $output.append(d);
                        });
                    }
                } else {
                    $output.text('');
                }
            });
        </script>
    </body>
</html>
